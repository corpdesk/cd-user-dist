(self.webpackChunkcd_user=self.webpackChunkcd_user||[]).push([[8016,1703],{1703:(k,v,o)=>{o.r(v),o.d(v,{DndDragImageRefDirective:()=>z,DndDraggableDirective:()=>m,DndDropzoneDirective:()=>L,DndHandleDirective:()=>F,DndModule:()=>B,DndPlaceholderRefDirective:()=>w});var d=o(7675),_=o(5228);const E=["move","copy","link"],f="application/x-dnd",D="application/json",g="Text";function b(n){return n.substr(0,f.length)===f}function y(n){if(n.dataTransfer){const t=n.dataTransfer.types;if(!t)return g;for(let e=0;e<t.length;e++)if(t[e]===g||t[e]===D||b(t[e]))return t[e]}return null}function c(n,t){return"all"===t||"uninitialized"===t?n:n.filter(function(e){return-1!==t.toLowerCase().indexOf(e)})}function S(n,t){const e=window.getComputedStyle(t),r=parseFloat(e.paddingTop)||0,i=parseFloat(e.paddingLeft)||0,a=parseFloat(e.borderTopWidth)||0,l=parseFloat(e.borderLeftWidth)||0;return{x:n.offsetX+i+l,y:n.offsetY+r+a}}const s={isDragging:!1,dropEffect:"none",effectAllowed:"all",type:void 0};function R(){s.isDragging=!1,s.dropEffect=void 0,s.effectAllowed=void 0,s.type=void 0}function h(n,t){!0===s.isDragging&&(s.dropEffect=t),n.dataTransfer&&(n.dataTransfer.dropEffect=t)}function C(n,t){let r=c(E,n.dataTransfer?n.dataTransfer.effectAllowed:"uninitialized");return!0===s.isDragging&&(r=c(r,s.effectAllowed)),t&&(r=c(r,t)),0===r.length?"none":n.ctrlKey&&-1!==r.indexOf("copy")?"copy":n.altKey&&-1!==r.indexOf("link")?"link":r[0]}function u(n){if(!0===s.isDragging)return s.type;const t=y(n);return null!==t&&t!==g&&t!==D&&t.substr(f.length+1)||void 0}function p(){return!1===s.isDragging}const I=s;let z=(()=>{class n{constructor(){this.dndDraggableDirective=(0,d.inject)((0,d.forwardRef)(()=>m)),this.elementRef=(0,d.inject)(d.ElementRef)}ngOnInit(){this.dndDraggableDirective.registerDragImage(this.elementRef)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=d.\u0275\u0275defineDirective({type:n,selectors:[["","dndDragImageRef",""]]}),n})(),m=(()=>{class n{constructor(){this.dndEffectAllowed="copy",this.dndDraggingClass="dndDragging",this.dndDraggingSourceClass="dndDraggingSource",this.dndDraggableDisabledClass="dndDraggableDisabled",this.dndDragImageOffsetFunction=S,this.dndStart=new d.EventEmitter,this.dndDrag=new d.EventEmitter,this.dndEnd=new d.EventEmitter,this.dndMoved=new d.EventEmitter,this.dndCopied=new d.EventEmitter,this.dndLinked=new d.EventEmitter,this.dndCanceled=new d.EventEmitter,this.draggable=!0,this.isDragStarted=!1,this.elementRef=(0,d.inject)(d.ElementRef),this.renderer=(0,d.inject)(d.Renderer2),this.ngZone=(0,d.inject)(d.NgZone),this.dragEventHandler=e=>this.onDrag(e)}set dndDisableIf(e){this.draggable=!e,this.draggable?this.renderer.removeClass(this.elementRef.nativeElement,this.dndDraggableDisabledClass):this.renderer.addClass(this.elementRef.nativeElement,this.dndDraggableDisabledClass)}set dndDisableDragIf(e){this.dndDisableIf=e}ngAfterViewInit(){this.ngZone.runOutsideAngular(()=>{this.elementRef.nativeElement.addEventListener("drag",this.dragEventHandler)})}ngOnDestroy(){this.elementRef.nativeElement.removeEventListener("drag",this.dragEventHandler),this.isDragStarted&&R()}onDragStart(e){if(!this.draggable)return!1;if(null!=this.dndHandle&&null==e._dndUsingHandle)return e.stopPropagation(),!1;(function O(n,t,e){s.isDragging=!0,s.dropEffect="none",s.effectAllowed=t,s.type=e,n.dataTransfer&&(n.dataTransfer.effectAllowed=t)})(e,this.dndEffectAllowed,this.dndType),this.isDragStarted=!0,function H(n,t,e){const r=f+(t.type?"-"+t.type:""),i=JSON.stringify(t);try{n.dataTransfer?.setData(r,i)}catch{try{n.dataTransfer?.setData(D,i)}catch{const x=c(E,e);n.dataTransfer&&(n.dataTransfer.effectAllowed=x[0]),n.dataTransfer?.setData(g,i)}}}(e,{data:this.dndDraggable,type:this.dndType},I.effectAllowed),this.dragImage=this.determineDragImage(),this.renderer.addClass(this.dragImage,this.dndDraggingClass),(null!=this.dndDragImageElementRef||null!=e._dndUsingHandle)&&function M(n,t,e){const r=e(n,t)||{x:0,y:0};n.dataTransfer.setDragImage(t,r.x,r.y)}(e,this.dragImage,this.dndDragImageOffsetFunction);const r=this.renderer.listen(this.elementRef.nativeElement,"drag",()=>{this.renderer.addClass(this.elementRef.nativeElement,this.dndDraggingSourceClass),r()});return this.dndStart.emit(e),e.stopPropagation(),setTimeout(()=>{this.renderer.setStyle(this.dragImage,"pointer-events","none")},100),!0}onDrag(e){this.dndDrag.emit(e)}onDragEnd(e){const r=I.dropEffect;let i;switch(this.renderer.setStyle(this.dragImage,"pointer-events","unset"),r){case"copy":i=this.dndCopied;break;case"link":i=this.dndLinked;break;case"move":i=this.dndMoved;break;default:i=this.dndCanceled}i.emit(e),this.dndEnd.emit(e),R(),this.isDragStarted=!1,this.renderer.removeClass(this.dragImage,this.dndDraggingClass),window.setTimeout(()=>{this.renderer.removeClass(this.elementRef.nativeElement,this.dndDraggingSourceClass)},0),e.stopPropagation()}registerDragHandle(e){this.dndHandle=e}registerDragImage(e){this.dndDragImageElementRef=e}determineDragImage(){return typeof this.dndDragImageElementRef<"u"?this.dndDragImageElementRef.nativeElement:this.elementRef.nativeElement}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=d.\u0275\u0275defineDirective({type:n,selectors:[["","dndDraggable",""]],hostVars:1,hostBindings:function(e,r){1&e&&d.\u0275\u0275listener("dragstart",function(a){return r.onDragStart(a)})("dragend",function(a){return r.onDragEnd(a)}),2&e&&d.\u0275\u0275attribute("draggable",r.draggable)},inputs:{dndDraggable:"dndDraggable",dndEffectAllowed:"dndEffectAllowed",dndType:"dndType",dndDraggingClass:"dndDraggingClass",dndDraggingSourceClass:"dndDraggingSourceClass",dndDraggableDisabledClass:"dndDraggableDisabledClass",dndDragImageOffsetFunction:"dndDragImageOffsetFunction",dndDisableIf:"dndDisableIf",dndDisableDragIf:"dndDisableDragIf"},outputs:{dndStart:"dndStart",dndDrag:"dndDrag",dndEnd:"dndEnd",dndMoved:"dndMoved",dndCopied:"dndCopied",dndLinked:"dndLinked",dndCanceled:"dndCanceled"}}),n})(),w=(()=>{class n{constructor(e){this.elementRef=e}ngOnInit(){this.elementRef.nativeElement.style.pointerEvents="none"}}return n.\u0275fac=function(e){return new(e||n)(d.\u0275\u0275directiveInject(d.ElementRef))},n.\u0275dir=d.\u0275\u0275defineDirective({type:n,selectors:[["","dndPlaceholderRef",""]]}),n})(),L=(()=>{class n{constructor(e,r,i){this.ngZone=e,this.elementRef=r,this.renderer=i,this.dndDropzone="",this.dndEffectAllowed="uninitialized",this.dndAllowExternal=!1,this.dndHorizontal=!1,this.dndDragoverClass="dndDragover",this.dndDropzoneDisabledClass="dndDropzoneDisabled",this.dndDragover=new d.EventEmitter,this.dndDrop=new d.EventEmitter,this.placeholder=null,this.disabled=!1,this.dragEnterEventHandler=a=>this.onDragEnter(a),this.dragOverEventHandler=a=>this.onDragOver(a),this.dragLeaveEventHandler=a=>this.onDragLeave(a)}set dndDisableIf(e){this.disabled=e,this.disabled?this.renderer.addClass(this.elementRef.nativeElement,this.dndDropzoneDisabledClass):this.renderer.removeClass(this.elementRef.nativeElement,this.dndDropzoneDisabledClass)}set dndDisableDropIf(e){this.dndDisableIf=e}ngAfterViewInit(){this.placeholder=this.tryGetPlaceholder(),this.removePlaceholderFromDOM(),this.ngZone.runOutsideAngular(()=>{this.elementRef.nativeElement.addEventListener("dragenter",this.dragEnterEventHandler),this.elementRef.nativeElement.addEventListener("dragover",this.dragOverEventHandler),this.elementRef.nativeElement.addEventListener("dragleave",this.dragLeaveEventHandler)})}ngOnDestroy(){this.elementRef.nativeElement.removeEventListener("dragenter",this.dragEnterEventHandler),this.elementRef.nativeElement.removeEventListener("dragover",this.dragOverEventHandler),this.elementRef.nativeElement.removeEventListener("dragleave",this.dragLeaveEventHandler)}onDragEnter(e){if(!0===e._dndDropzoneActive)return void this.cleanupDragoverState();if(null==e._dndDropzoneActive){const i=document.elementFromPoint(e.clientX,e.clientY);this.elementRef.nativeElement.contains(i)&&(e._dndDropzoneActive=!0)}const r=u(e);this.isDropAllowed(r)&&e.preventDefault()}onDragOver(e){if(e.defaultPrevented)return;const r=u(e);if(!this.isDropAllowed(r))return;this.checkAndUpdatePlaceholderPosition(e);const i=C(e,this.dndEffectAllowed);"none"!==i?(e.preventDefault(),h(e,i),this.dndDragover.emit(e),this.renderer.addClass(this.elementRef.nativeElement,this.dndDragoverClass)):this.cleanupDragoverState()}onDrop(e){try{const r=u(e);if(!this.isDropAllowed(r))return;const i=function T(n,t){const e=y(n);return!0===t?null!==e&&b(e)?JSON.parse(n.dataTransfer?.getData(e)??"{}"):{}:null!==e?JSON.parse(n.dataTransfer?.getData(e)??"{}"):{}}(e,p());if(!this.isDropAllowed(i.type))return;e.preventDefault();const a=C(e);if(h(e,a),"none"===a)return;const l=this.getPlaceholderIndex();if(-1===l)return;this.dndDrop.emit({event:e,dropEffect:a,isExternal:p(),data:i.data,index:l,type:r}),e.stopPropagation()}finally{this.cleanupDragoverState()}}onDragLeave(e){if(e.preventDefault(),e.stopPropagation(),null==e._dndDropzoneActive){const r=document.elementFromPoint(e.clientX,e.clientY);if(this.elementRef.nativeElement.contains(r))return void(e._dndDropzoneActive=!0)}this.cleanupDragoverState(),h(e,"none")}isDropAllowed(e){if(this.disabled||p()&&!this.dndAllowExternal)return!1;if(!this.dndDropzone||!e)return!0;if(!Array.isArray(this.dndDropzone))throw new Error("dndDropzone: bound value to [dndDropzone] must be an array!");return-1!==this.dndDropzone.indexOf(e)}tryGetPlaceholder(){return typeof this.dndPlaceholderRef<"u"?this.dndPlaceholderRef.elementRef.nativeElement:this.elementRef.nativeElement.querySelector("[dndPlaceholderRef]")}removePlaceholderFromDOM(){null!==this.placeholder&&null!==this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)}checkAndUpdatePlaceholderPosition(e){if(null===this.placeholder)return;this.placeholder.parentNode!==this.elementRef.nativeElement&&this.renderer.appendChild(this.elementRef.nativeElement,this.placeholder);const r=function A(n,t){let e=t;for(;e.parentNode!==n;){if(!e.parentNode)return null;e=e.parentNode}return e}(this.elementRef.nativeElement,e.target);null!==r&&r!==this.placeholder&&(function P(n,t,e){const r=t.getBoundingClientRect();return e?n.clientX<r.left+r.width/2:n.clientY<r.top+r.height/2}(e,r,this.dndHorizontal)?r.previousSibling!==this.placeholder&&this.renderer.insertBefore(this.elementRef.nativeElement,this.placeholder,r):r.nextSibling!==this.placeholder&&this.renderer.insertBefore(this.elementRef.nativeElement,this.placeholder,r.nextSibling))}getPlaceholderIndex(){if(null!==this.placeholder)return Array.prototype.indexOf.call(this.elementRef.nativeElement.children,this.placeholder)}cleanupDragoverState(){this.renderer.removeClass(this.elementRef.nativeElement,this.dndDragoverClass),this.removePlaceholderFromDOM()}}return n.\u0275fac=function(e){return new(e||n)(d.\u0275\u0275directiveInject(d.NgZone),d.\u0275\u0275directiveInject(d.ElementRef),d.\u0275\u0275directiveInject(d.Renderer2))},n.\u0275dir=d.\u0275\u0275defineDirective({type:n,selectors:[["","dndDropzone",""]],contentQueries:function(e,r,i){if(1&e&&d.\u0275\u0275contentQuery(i,w,5),2&e){let a;d.\u0275\u0275queryRefresh(a=d.\u0275\u0275loadQuery())&&(r.dndPlaceholderRef=a.first)}},hostBindings:function(e,r){1&e&&d.\u0275\u0275listener("drop",function(a){return r.onDrop(a)})},inputs:{dndDropzone:"dndDropzone",dndEffectAllowed:"dndEffectAllowed",dndAllowExternal:"dndAllowExternal",dndHorizontal:"dndHorizontal",dndDragoverClass:"dndDragoverClass",dndDropzoneDisabledClass:"dndDropzoneDisabledClass",dndDisableIf:"dndDisableIf",dndDisableDropIf:"dndDisableDropIf"},outputs:{dndDragover:"dndDragover",dndDrop:"dndDrop"}}),n})(),F=(()=>{class n{constructor(){this.draggable=!0,this.dndDraggableDirective=(0,d.inject)(m)}ngOnInit(){this.dndDraggableDirective.registerDragHandle(this)}onDragEvent(e){e._dndUsingHandle=!0}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=d.\u0275\u0275defineDirective({type:n,selectors:[["","dndHandle",""]],hostVars:1,hostBindings:function(e,r){1&e&&d.\u0275\u0275listener("dragstart",function(a){return r.onDragEvent(a)})("dragend",function(a){return r.onDragEvent(a)}),2&e&&d.\u0275\u0275attribute("draggable",r.draggable)}}),n})(),B=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=d.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=d.\u0275\u0275defineInjector({imports:[_.CommonModule]}),n})()}}]);